<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Server.Name}} - Files</title>
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="dashboard-page">
    <div class="sidebar">
        <div class="sidebar-menu">
            <a href="/dashboard" class="menu-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                <span>Home</span>
            </a>
            <a href="/server/{{.Server.Name}}" class="menu-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                </svg>
                <span>Terminal</span>
            </a>
            <a href="/server/{{.Server.Name}}/files" class="menu-item active">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Files</span>
            </a>
            <a href="/server/{{.Server.Name}}/startup" class="menu-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                </svg>
                <span>Startup</span>
            </a>
            <a href="/server/{{.Server.Name}}/schedule" class="menu-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Schedule</span>
            </a>
            <a href="/server/{{.Server.Name}}/backups" class="menu-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <span>Backups</span>
            </a>
        </div>
        <div class="sidebar-user">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>{{.User.Username}}</span>
        </div>
    </div>

    <div class="main-content">
        <!-- FILE EDITOR CONTAINER (Hidden by default, shown when editing) -->
        <div class="file-editor-container" id="fileEditorContainer">
            <!-- Editor Header -->
            <div class="file-editor-header">
                <div class="file-editor-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                    </svg>
                    <h3 id="editorFileName">Loading...</h3>
                    <span class="file-editor-path" id="editorFilePath"></span>
                </div>
                <div class="file-editor-actions">
                    <button class="file-editor-btn file-editor-btn-cancel" id="editorCancelBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Cancel
                    </button>
                    <button class="file-editor-btn file-editor-btn-save" id="editorSaveBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                        </svg>
                        Save
                    </button>
                </div>
            </div>

            <!-- Editor Body -->
            <div class="file-editor-body">
                <textarea 
                    id="fileEditorTextarea" 
                    class="file-editor-textarea" 
                    placeholder="File content will appear here..."
                    spellcheck="false"
                ></textarea>

                <!-- Editor Info -->
                <div class="file-editor-info">
                    <div class="file-editor-info-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
                        </svg>
                        <span id="editorFileSize">0 bytes</span>
                    </div>
                    <div class="file-editor-info-item">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <span id="editorLineCount">0 lines</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- FILE MANAGER CONTAINER -->
        <div class="file-manager-container" id="fileManagerContainer">
            <!-- Header / Top Bar -->
            <div class="file-manager-header">
                <div class="file-manager-header-left">
                    <!-- Select All Checkbox -->
                    <div class="select-all-container">
                        <input type="checkbox" id="selectAllCheckbox" class="select-all-checkbox">
                        <label for="selectAllCheckbox" class="select-all-label">Select All</label>
                    </div>

                    <!-- Breadcrumb Navigation -->
                    <div class="breadcrumb-container">
                        <div class="breadcrumb">
                            <span class="breadcrumb-item" id="breadcrumbHome">{{.Server.Name}}</span>
                            <span id="breadcrumbPath"></span>
                        </div>
                    </div>
                </div>

                <div class="file-manager-header-right">
                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <!-- Clipboard Buttons (Paste & Cancel) - Hidden by default -->
                        <div class="clipboard-buttons" id="clipboardButtons" style="display: none;">
                            <button class="action-btn action-btn-success" id="pasteBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                                <span>Paste</span>
                            </button>
                            <button class="action-btn action-btn-primary" id="cancelClipboardBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                                <span>Cancel</span>
                            </button>
                        </div>

                        <button class="action-btn action-btn-primary" id="createDirBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                            </svg>
                            <span>Create Directory</span>
                        </button>
                        <button class="action-btn action-btn-success" id="uploadBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span>Upload</span>
                        </button>
                        <input type="file" id="fileInput" multiple style="display: none;">
                        <button class="upload-indicator" id="uploadIndicator" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span class="upload-indicator-badge" id="uploadBadge">0</span>
                        </button>
                        <button class="action-btn action-btn-info" id="newFileBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span>New File</span>
                        </button>
                    </div>

                    <!-- View Toggle -->
                    <div class="view-toggle">
                        <button class="view-toggle-btn" id="gridViewBtn" title="Grid View">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                            </svg>
                        </button>
                        <button class="view-toggle-btn active" id="listViewBtn" title="List View">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- File List Container -->
            <div class="file-list-container" id="fileListContainer">
                <div class="file-list-loading">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.25"></circle>
                        <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="floating-actions" id="floatingActions">
            <button class="floating-action-btn floating-action-btn-add" data-tooltip="Move" id="moveBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
            </button>
            <button class="floating-action-btn floating-action-btn-copy" data-tooltip="Duplicate" id="duplicateBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            </button>
            <button class="floating-action-btn floating-action-btn-archive" data-tooltip="Archive" id="archiveBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                </svg>
            </button>
            <button class="floating-action-btn floating-action-btn-delete" data-tooltip="Delete" id="deleteBtn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Create Directory Modal -->
    <div class="modal-overlay" id="createDirModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create Directory</h3>
                <button class="modal-close" id="closeCreateDirModal">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="createDirForm">
                <div class="modal-body">
                    <div class="modal-form-group">
                        <label for="directoryName">Directory Name</label>
                        <div class="modal-input-wrapper">
                            <input 
                                type="text" 
                                id="directoryName" 
                                name="directoryName" 
                                class="modal-input" 
                                placeholder="Enter directory name"
                                autocomplete="off"
                                required
                            >
                            <div class="autocomplete-dropdown" id="dirAutocomplete"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="modal-btn modal-btn-cancel" id="cancelCreateDir">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-primary" id="submitCreateDir">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- New File Modal -->
    <div class="modal-overlay" id="newFileModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create New File</h3>
                <button class="modal-close" id="closeNewFileModal">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="newFileForm">
                <div class="modal-body">
                    <div class="modal-form-group">
                        <label for="fileName">File Name</label>
                        <div class="modal-input-wrapper">
                            <input 
                                type="text" 
                                id="fileName" 
                                name="fileName" 
                                class="modal-input" 
                                placeholder="Enter file name (e.g., config.yml, script.sh)"
                                autocomplete="off"
                                required
                            >
                            <div class="autocomplete-dropdown" id="fileAutocomplete"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="modal-btn modal-btn-cancel" id="cancelNewFile">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-primary" id="submitNewFile">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Modal -->
    <div class="modal-overlay" id="renameModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Rename</h3>
                <button class="modal-close" id="closeRenameModal">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="renameForm">
                <div class="modal-body">
                    <div class="modal-form-group">
                        <label for="renameInput">Current: <span id="renameOldName" style="color: #60a5fa;"></span></label>
                        <input 
                            type="text" 
                            id="renameInput" 
                            name="renameInput" 
                            class="modal-input" 
                            placeholder="Enter new name"
                            autocomplete="off"
                            required
                        >
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="modal-btn modal-btn-cancel" id="cancelRename">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-primary" id="submitRename">Rename</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Drag & Drop Overlay -->
    <div class="drag-drop-overlay" id="dragDropOverlay">
        <div class="drag-drop-box">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
            <p>Drag and drop files to upload</p>
        </div>
    </div>

    <!-- Upload Progress Panel -->
    <div class="upload-panel" id="uploadPanel">
        <div class="upload-panel-header">
            <h3>File Uploads</h3>
            <button class="upload-panel-close" id="closeUploadPanel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div class="upload-panel-body" id="uploadPanelBody"></div>
        <div class="upload-panel-footer">
            <button class="modal-btn modal-btn-cancel" id="cancelAllUploads">Cancel All</button>
            <button class="modal-btn modal-btn-primary" id="closeUploadPanelBtn">Close</button>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="/static/js/files/utils.js"></script>
    <script src="/static/js/files/file-manager.js"></script>
    <script src="/static/js/files/file-editor.js"></script>
    <script src="/static/js/files/file-uploader.js"></script>
    <script src="/static/js/files/context-menu.js"></script>
    <script src="/static/js/files/modals.js"></script>
    <script src="/static/js/files/files.js"></script>    
    <script src="/static/js/utils/utils.js"></script>
    <script src="/static/js/main/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const serverName = '{{.Server.Name}}';
            initFileManager(serverName);
        });
    </script>
</body>
</html>